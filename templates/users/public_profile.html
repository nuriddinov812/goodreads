{% extends "base.html" %}
{% load static %}
{% block title %}{{ profile_user.username }} — Profile{% endblock title %}

{% block content %}
<section class="card-container">
  <div class="card-box">
    <div class="profile-header">
      {% if profile_user.profile_picture %}
        <img src="{{ profile_user.profile_picture.url }}" alt="{{ profile_user.username }}" class="profile-picture">
      {% else %}
        <img src="{% static 'images/default_profile_pic.jpg' %}" alt="{{ profile_user.username }}" class="profile-picture">
      {% endif %}
      <div class="profile-header-info">
        <h1 class="profile-name">{{ profile_user.first_name }} {{ profile_user.last_name }}</h1>
        <p class="profile-username">@{{ profile_user.username }}</p>
      </div>
    </div>

    <div class="profile-info">
      <div class="profile-stat">
        <span class="profile-stat-value">{{ recent_reviews|length }}</span>
        <span class="profile-stat-label">Reviews</span>
      </div>
      <div class="profile-stat">
        <span class="profile-stat-value">{{ profile_user.email }}</span>
        <span class="profile-stat-label">Email</span>
      </div>
    </div>
  </div>
</section>

<section class="card-container">
  <div class="card-box">
    <h2 class="card-title">Recent Reviews</h2>
    {% if recent_reviews %}
      <div class="reviews-list">
        {% for review in recent_reviews %}
          <div class="review-item">
            <a href="{% url 'book_detail' review.book.pk %}" class="review-item-book">
              {% if review.book.cover_image %}
                <img src="{{ review.book.cover_image.url }}" alt="{{ review.book.title }}" class="review-item-cover">
              {% else %}
                <img src="{% static 'images/default_book.png' %}" alt="{{ review.book.title }}" class="review-item-cover">
              {% endif %}
              <div class="review-item-info">
                <h3 class="review-item-title">{{ review.book.title }}</h3>
                <p class="review-item-stars">{% for i in "12345" %}{% if forloop.counter <= review.stars_given %}⭐{% endif %}{% endfor %}</p>
                {% if review.created_at %}
                  <p class="review-item-time">{{ review.created_at|timesince }} ago</p>
                {% endif %}
              </div>
            </a>
            {% if review.comment %}
              <p class="review-item-comment">“{{ review.comment|truncatewords:25 }}”</p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No reviews yet.</p>
    {% endif %}
  </div>
</section>
{% endblock content %}
