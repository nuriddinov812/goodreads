{% extends "base.html" %}
{% load static %}

{% block title %}Goodreads - Discover Amazing Books{% endblock %}

{% block body_class %}landing-page-body{% endblock %}

{% block content %}

<!-- Hero -->
<section class="hero">
    <div class="hero-content">
        {% if user.is_authenticated %}
            <h1>Welcome back, <span style="color: #fbbf24;">{{ user.first_name|default:user.username }}</span>!</h1>
            <p class="hero-sub">Discover your next favorite book</p>
        {% else %}
            <h1>Find Your Next <span style="color: #fbbf24;">Great Read</span></h1>
            <p class="hero-sub">Join thousands of readers sharing their favorite books</p>
        {% endif %}
        
        <form action="{% url 'book_list' %}" method="get" class="hero-search">
            <input type="text" name="q" placeholder="Search books, authors..." required>
            <button type="submit">Search</button>
        </form>
        
        <div class="hero-stats">
            <div class="stat">
                <div class="stat-num">{{ total_books }}+</div>
                <div class="stat-label">Books</div>
            </div>
            <div class="stat">
                <div class="stat-num">{{ total_reviews }}+</div>
                <div class="stat-label">Reviews</div>
            </div>
            <div class="stat">
                <div class="stat-num">{{ total_users }}+</div>
                <div class="stat-label">Readers</div>
            </div>
        </div>
    </div>
</section>

<div class="wrapper">
    
    <!-- Featured -->
    {% if featured_book %}
    <section class="featured">
        <span class="featured-badge">‚ú® Featured Book</span>
        <div class="featured-grid">
            <div class="featured-img">
                {% if featured_book.cover_image %}
                    <img src="{{ featured_book.cover_image.url }}" alt="{{ featured_book.title }}">
                {% else %}
                    <div style="background: #e2e8f0; height: 100%; display: flex; align-items: center; justify-content: center;">No cover</div>
                {% endif %}
            </div>
            <div class="featured-info">
                <h2>{{ featured_book.title }}</h2>
                <p class="featured-author">by {% for ba in featured_book.bookauthor_set.all %}{{ ba.author.first_name }} {{ ba.author.last_name }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
                <div class="featured-rating">
                    {% for i in "12345" %}{% if forloop.counter <= featured_book.avg_rating %}‚òÖ{% else %}‚òÜ{% endif %}{% endfor %}
                    <strong>{{ featured_book.avg_rating|floatformat:1 }}/5</strong>
                </div>
                <p class="featured-desc">{{ featured_book.description|truncatewords:50 }}</p>
                <a href="{% url 'book_detail' featured_book.pk %}" class="featured-btn">Read More</a>
            </div>
        </div>
    </section>
    {% endif %}
    
    <!-- Trending -->
    {% if top_rated_books %}
    <section>
        <div class="section-head">
            <h2 class="section-title">Trending This Week</h2>
            <a href="{% url 'book_list' %}" class="view-all">View All ‚Üí</a>
        </div>
        <div class="books-grid">
            {% for book in top_rated_books %}
            <a href="{% url 'book_detail' book.pk %}" class="book-card">
                <div class="book-cover">
                    {% if book.cover_image %}
                        <img src="{{ book.cover_image.url }}" alt="{{ book.title }}">
                    {% else %}
                        <div style="background: #e2e8f0; height: 100%; display: flex; align-items: center; justify-content: center;">üìñ</div>
                    {% endif %}
                    <div class="book-badge">‚≠ê {{ book.avg_rating|floatformat:1 }}</div>
                </div>
                <div class="book-info">
                    <h3 class="book-title">{{ book.title }}</h3>
                    <p class="book-author">{% for ba in book.bookauthor_set.all %}{{ ba.author.first_name }} {{ ba.author.last_name }}{% if not forloop.last %}, {% endif %}{% empty %}Unknown{% endfor %}</p>
                    <div class="book-meta">{{ book.review_count }} reviews</div>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- Reviews -->
    {% if recent_reviews %}
    <section class="reviews">
        <div class="section-head">
            <h2 class="section-title">Community Reviews</h2>
        </div>
        <div class="reviews-grid">
            {% for review in recent_reviews|slice:":6" %}
            <div class="review">
                <div class="review-head">
                    {% if review.user.profile_picture %}
                        <img src="{{ review.user.profile_picture.url }}" alt="{{ review.user.username }}" class="avatar">
                    {% else %}
                        <div class="avatar-init">{{ review.user.username|slice:":1"|upper }}</div>
                    {% endif %}
                    <div class="review-user">
                        <h4><a href="{% url 'user_profile' review.user.username %}" style="color: inherit; text-decoration: none;">{{ review.user.username }}</a></h4>
                        <div class="review-meta">{{ review.created_at|timesince }} ago</div>
                    </div>
                </div>
                <div class="review-stars">
                    {% for i in "12345" %}{% if forloop.counter <= review.stars_given %}‚òÖ{% else %}‚òÜ{% endif %}{% endfor %}
                </div>
                <p class="review-text">"{{ review.comment|truncatewords:20 }}"</p>
                <small style="color: #667eea; font-weight: 600;">{{ review.book.title|truncatechars:40 }}</small>
            </div>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- Contributors -->
    {% if top_reviewers %}
    <section class="contributors">
        <div class="section-head">
            <h2 class="section-title">Top Contributors</h2>
        </div>
        <div class="contributors-list">
            {% for reviewer in top_reviewers|slice:":6" %}
            <a href="{% url 'user_profile' reviewer.username %}" class="contributor">
                <div class="rank">#{{ forloop.counter }}</div>
                {% if reviewer.profile_picture %}
                    <img src="{{ reviewer.profile_picture.url }}" alt="{{ reviewer.username }}" class="avatar">
                {% else %}
                    <div class="avatar-init">{{ reviewer.username|slice:":1"|upper }}</div>
                {% endif %}
                <div>
                    <h4 class="contr-info">{{ reviewer.username }}</h4>
                    <div class="contr-stats">{{ reviewer.review_count }} reviews</div>
                </div>
            </a>
            {% endfor %}
        </div>
    </section>
    {% endif %}
    
    <!-- CTA -->
    {% if not user.is_authenticated %}
    <section class="cta">
        <h2>Ready to Join?</h2>
        <p class="cta-text">Start tracking your reading and discovering your next favorite book.</p>
        <div class="cta-buttons">
            <a href="{% url 'register' %}" class="btn-cta btn-cta-main">Sign Up Free</a>
            <a href="{% url 'login' %}" class="btn-cta btn-cta-sec">Log In</a>
        </div>
    </section>
    {% endif %}
</div>

<!-- Footer -->
<footer class="footer">
    <div class="footer-links">
        <a href="{% url 'book_list' %}" class="footer-link">Books</a>
        {% if user.is_authenticated %}
            <a href="{% url 'profile' %}" class="footer-link">Profile</a>
            <a href="{% url 'logout' %}" class="footer-link">Logout</a>
        {% else %}
            <a href="{% url 'login' %}" class="footer-link">Login</a>
            <a href="{% url 'register' %}" class="footer-link">Register</a>
        {% endif %}
    </div>
    <div class="footer-bottom">
        <p>&copy; 2025 Goodreads Clone. For book lovers. üìö</p>
    </div>
</footer>

{% endblock %}
